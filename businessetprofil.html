

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portefeuille</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="businessetprofil.css">
</head>
<body>

<div class="container py-4">
    <div class="welcome-banner p-4 mb-4 text-white position-relative shadow">
        <div class="d-flex align-items-center mb-1">
            <i class="fas fa-wand-magic-sparkles me-2"></i>
            <span class="small opacity-75">Control your flow</span>
        </div>
        <h2 class="fw-bold mb-1" data-i18n="welcome">Bonjour, <span data-user-name>Utilisateur</span></h2>
        <p class="text-warning mb-0 small" data-i18n="warning">Attention √† vos d√©penses ce mois-ci.</p>
        
    </div>

    <div class="tab-content">
        <div class="tab-pane fade" id="content-dashboard">
            <div class="text-center py-5">
                <p class="text-muted">Contenu du Tableau de Bord √† venir...</p>
            </div>
        </div>

        <div class="tab-pane fade show active" id="content-business">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div class="d-flex align-items-center">
                    <div class="icon-square-blue me-3">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div>
                        <h4 class="text-white mb-0">G√©rance de Business</h4>
                        <small class="text-muted"><span id="businessCount">0</span> business en gestion</small>
                    </div>
                </div>
                <button class="btn btn-primary-gradient px-4 py-2 shadow-sm" data-bs-toggle="modal" data-bs-target="#addBusinessModal">
                    <i class="fas fa-plus me-2"></i>Nouveau Business
                </button>
            </div>

            <div class="text-center py-5 mt-4">
                <div class="empty-business-icon mx-auto mb-4 shadow-lg">
                    <i class="fas fa-briefcase fa-3x"></i>
                </div>
                <h5 class="text-white fw-bold mb-3">Aucun business enregistr√©</h5>
                <p class="text-muted mb-4 mx-auto" style="max-width: 400px;">
                    Commencez par ajouter votre premier business pour suivre sa performance
                </p>
                <button class="btn btn-primary-gradient px-4 py-2 rounded-pill">
                    <i class="fas fa-plus me-2"></i>Ajouter mon premier business
                </button>
            </div>
        </div>

        <div class="tab-pane fade" id="content-history">
            <div class="text-center py-5">
                <p class="text-muted">Aucun historique disponible.</p>
            </div>
        </div>

       

        <div class="tab-pane fade" id="content-profil">
    <div class="card bg-dark-card border-0 overflow-hidden mb-4 shadow-lg">
        <div class="profile-banner-tri"></div>
        <div class="card-body p-4 pt-0">
            <div class="d-flex align-items-end mb-4 profile-header-overlap">
                <div class="avatar-dk-large shadow-lg" id="profileAvatar">DM</div>
                <div class="flex-grow-1">
                    <h3 class="text-white fw-bold mb-1" id="profileName">Utilisateur <i class="fas fa-crown text-warning fs-5"></i></h3>
                    <p class="text-muted mb-2" id="profileBio">Utilisateur de la plateforme</p>
                    <div class="d-flex text-muted small">
                        <span class="me-3"><i class="fas fa-map-marker-alt me-1"></i> <span id="profileLocation">Non sp√©cifi√©</span></span>
                        <span><i class="fas fa-calendar-alt me-1"></i> Membre depuis <span id="profileDate">Janvier 2024</span></span>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary-gradient btn-sm px-3" id="editProfileBtn"><i class="fas fa-pen me-2"></i>Modifier le profil</button>
                    <button class="btn btn-dark-nav btn-sm"><i class="fas fa-share-alt"></i></button>
                </div>
            </div>

          

<div class="row g-3">
    <div class="col-md-3 col-6">
        <div class="stat-card p-3 text-center">
            <div class="stat-icon-wrapper stat-icon-blue mx-auto mb-2">
                <i class="fas fa-wave-square"></i>
            </div>
            <h4 class="text-white fw-bold mb-0" data-stat-count>0</h4>
            <small class="text-muted">Transactions</small>
        </div>
    </div>
    <div class="col-md-3 col-6">
        <div class="stat-card p-3 text-center">
            <div class="stat-icon-wrapper stat-icon-green mx-auto mb-2">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <h4 class="text-white fw-bold mb-0"><span data-stat-savings>0</span> FCFA</h4>
            <small class="text-muted">√âpargne totale</small>
        </div>
    </div>
    <div class="col-md-3 col-6">
        <div class="stat-card p-3 text-center">
            <div class="stat-icon-wrapper stat-icon-yellow mx-auto mb-2">
                <i class="fas fa-wallet2"></i>
            </div>
            <h4 class="text-white fw-bold mb-0"><span data-stat-current>0</span> FCFA</h4>
            <small class="text-muted">Solde actuel</small>
        </div>
    </div>
    <div class="col-md-3 col-6">
        <div class="stat-card p-3 text-center">
            <div class="stat-icon-wrapper stat-icon-purple mx-auto mb-2">
                <i class="fas fa-arrow-trend-up"></i>
            </div>
            <h4 class="text-white fw-bold mb-0"><span data-stat-income>0</span> FCFA</h4>
            <small class="text-muted">Revenus totaux</small>
        </div>
    </div>
</div>


        </div>
    </div>

    <div class="d-flex gap-2 mb-4 overflow-auto pb-2">
        <button class="btn btn-purple-gradient btn-sm px-4 rounded-pill">Profil</button>
        <button class="btn btn-dark-nav btn-sm px-4 rounded-pill text-muted">S√©curit√©</button>
        <button class="btn btn-dark-nav btn-sm px-4 rounded-pill text-muted">Pr√©f√©rences</button>
        <button class="btn btn-dark-nav btn-sm px-4 rounded-pill text-muted">Activit√©</button>
    </div>

    <div class="card bg-dark-card border-0 p-4 shadow-lg mb-4">
        <h5 class="text-white mb-4 d-flex align-items-center">
            <i class="fas fa-user-circle me-2 text-primary"></i> Informations personnelles
        </h5>
        <div class="row g-4">
            <div class="col-md-6">
                <label class="text-muted small d-block">Pr√©nom</label>
                <span class="text-white fw-bold" id="infoPr√©nom">-</span>
            </div>
            <div class="col-md-6">
                <label class="text-muted small d-block">Nom</label>
                <span class="text-white fw-bold" id="infoNom">-</span>
            </div>
            <div class="col-md-6">
                <label class="text-muted small d-block">Nom d'utilisateur</label>
                <span class="text-white" id="infoUsername">-</span>
            </div>
            <div class="col-md-6">
                <label class="text-muted small d-block">Solde actuel</label>
                <span class="text-white fw-bold" id="infoBalance">0 FCFA</span>
            </div>
        </div>
    </div>


<div class="card bg-dark-card border-0 p-4 shadow-lg mb-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="text-white mb-0">Achievements</h5>
        <span class="badge rounded-pill bg-success bg-opacity-10 text-success px-3 py-2">3/5</span>
    </div>

    <div class="row g-3">
        <div class="col-md-4">
            <div class="achievement-card active p-3 h-100">
                <div class="d-flex justify-content-between mb-3">
                    <div class="stat-icon-wrapper stat-icon-yellow">
                        <i class="fas fa-star"></i>
                    </div>
                    <i class="fas fa-check-circle text-success shadow-sm"></i>
                </div>
                <h6 class="text-white mb-1">Premier pas</h6>
                <p class="text-muted smaller mb-2">Premi√®re transaction enregistr√©e</p>
                <div class="smaller text-muted opacity-75"><i class="fas fa-calendar-alt me-1"></i>5 Jan 2024</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="achievement-card active p-3 h-100">
                <div class="d-flex justify-content-between mb-3">
                    <div class="stat-icon-wrapper stat-icon-blue">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <i class="fas fa-check-circle text-success shadow-sm"></i>
                </div>
                <h6 class="text-white mb-1">√âpargnant r√©gulier</h6>
                <p class="text-muted smaller mb-2">√âpargn√© pendant 30 jours cons√©cutifs</p>
                <div class="smaller text-muted opacity-75"><i class="fas fa-calendar-alt me-1"></i>15 F√©v 2024</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="achievement-card active p-3 h-100">
                <div class="d-flex justify-content-between mb-3">
                    <div class="stat-icon-wrapper stat-icon-purple">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <i class="fas fa-check-circle text-success shadow-sm"></i>
                </div>
                <h6 class="text-white mb-1">Expert du budget</h6>
                <p class="text-muted smaller mb-2">Respect√© le budget 3 mois de suite</p>
                <div class="smaller text-muted opacity-75"><i class="fas fa-calendar-alt me-1"></i>1 Mar 2024</div>
            </div>
        </div>
    </div>
</div>




  
<div class="card border-danger border-opacity-25 bg-danger bg-opacity-10 p-4 mb-5 shadow-sm">
    <div class="d-flex align-items-center mb-3">
        <div class="stat-icon-wrapper stat-icon-red me-3">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h6 class="text-danger fw-bold mb-0">Zone dangereuse</h6>
    </div>
    
    <p class="text-muted smaller mb-3">
        La d√©connexion fermera votre session active. <br>
        Vous devrez vous reconnecter pour acc√©der √† votre compte.
    </p>
    
    <button class="btn btn-danger btn-sm px-4 rounded-pill shadow-sm" onclick="logout()">
        <i class="fas fa-sign-out-alt me-2"></i>Se d√©connecter
    </button>
</div>



    <div class="text-center py-4 opacity-50">
     
        <p class="smaller">Plateforme de Gestion Intelligente de Portefeuille</p>
    </div>
</div>



          
          


<!-- MODAL MODIFIER PROFIL -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark-card border-light">
      <div class="modal-header border-light">
        <h5 class="modal-title text-white" id="editProfileLabel">Modifier le profil</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProfileForm">
          <div class="mb-3">
            <label for="editPrenom" class="form-label text-white">Pr√©nom</label>
            <input type="text" class="form-control bg-input border-light text-white" id="editPrenom" placeholder="Votre pr√©nom">
          </div>
          <div class="mb-3">
            <label for="editNom" class="form-label text-white">Nom</label>
            <input type="text" class="form-control bg-input border-light text-white" id="editNom" placeholder="Votre nom">
          </div>
          <div class="mb-3">
            <label for="editUsername" class="form-label text-white">Nom d'utilisateur</label>
            <input type="text" class="form-control bg-input border-light text-white" id="editUsername" placeholder="Votre nom d'utilisateur" disabled>
          </div>
        </form>
      </div>
      <div class="modal-footer border-light">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-primary-gradient" id="saveProfileBtn">Enregistrer les modifications</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/db.js"></script>
<script src="js/session.js"></script>
<script src="js/navbar.js"></script>
<script src="js/business.js"></script>
<script src="js/sync-data.js"></script>
<script>
// Charger les informations utilisateur
function loadProfileInfo() {
    console.log('üìù Chargement des informations du profil...');
    
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (!loggedInUser) {
        console.error('‚ùå Aucun utilisateur connect√©');
        return;
    }
    
    try {
        const user = JSON.parse(loggedInUser);
        console.log('üë§ Utilisateur trouv√©:', user);
        
        // D√©terminer le nom √† afficher (pr√©nom ou username)
        const displayName = user.prenom || user.username || 'Utilisateur';
        
        // Mettre √† jour le welcome banner
        const userNameElement = document.querySelector('[data-user-name]');
        if (userNameElement) {
            userNameElement.textContent = displayName;
            console.log('‚úÖ Welcome banner mis √† jour:', displayName);
        }
        
        // Mettre √† jour les informations personnelles
        const prenomEl = document.getElementById('infoPr√©nom');
        const nomEl = document.getElementById('infoNom');
        const usernameEl = document.getElementById('infoUsername');
        
        if (prenomEl) prenomEl.textContent = user.prenom || user.username || '-';
        if (nomEl) nomEl.textContent = user.nom || '-';
        if (usernameEl) usernameEl.textContent = user.username || '-';
        
        console.log('‚úÖ Informations personnelles mises √† jour');
        
        // Mettre √† jour l'avatar
        const avatar = document.getElementById('profileAvatar');
        if (avatar) {
            const firstChar = (user.prenom || user.username || 'U').charAt(0).toUpperCase();
            const secondChar = (user.nom || user.username || 'U').charAt(1).toUpperCase();
            avatar.textContent = (firstChar + secondChar).substring(0, 2);
            console.log('‚úÖ Avatar mis √† jour:', firstChar + secondChar);
        }
        
        // Mettre √† jour le nom du profil
        const profileName = document.getElementById('profileName');
        if (profileName) {
            const fullName = `${user.prenom || user.username || 'Utilisateur'} ${user.nom || ''}`.trim();
            profileName.innerHTML = `${fullName} <i class="fas fa-crown text-warning fs-5"></i>`;
            console.log('‚úÖ Nom du profil mis √† jour:', fullName);
        }
        
        // Mettre √† jour la bio
        const profileBio = document.getElementById('profileBio');
        if (profileBio) {
            profileBio.textContent = `Utilisateur de la plateforme`;
        }
        
        // Charger le solde depuis la DB
        ensureDatabaseReady(function() {
            console.log('üìä DB pr√™te, chargement des statistiques...');
            
            getTransactions(user.username, function(transactions) {
                console.log('üìã Transactions trouv√©es:', transactions.length);
                
                let totalIncome = 0;
                let totalExpense = 0;
                let totalSavings = 0;
                
                transactions.forEach(tx => {
                    if (tx.type === 'revenu' || tx.type === 'salaire') {
                        totalIncome += tx.amount;
                    } else if (tx.type === 'depense') {
                        totalExpense += tx.amount;
                    } else if (tx.type === 'epargne') {
                        totalSavings += tx.amount;
                    }
                });
                
                // Charger aussi les business pour calculer les budgets
                getBusinesses(user.username, function(businesses) {
                    console.log('üè¢ Businesses trouv√©s:', businesses.length);
                    
                    let totalBusinessBudget = 0;
                    
                    businesses.forEach(business => {
                        totalBusinessBudget += business.budget || 0;
                    });
                    
                    // Solde actuel = Revenus - D√©penses
                    const currentBalance = totalIncome - totalExpense;
                    
                    // Solde disponible = Solde actuel - √âpargnes - Budgets des business
                    const availableBalance = currentBalance - totalSavings - totalBusinessBudget;
                    
                    // Mettre √† jour l'affichage des soldes
                    const infoBalance = document.getElementById('infoBalance');
                    if (infoBalance) {
                        infoBalance.textContent = currentBalance.toLocaleString('fr-FR', {maximumFractionDigits: 0}) + ' FCFA';
                        console.log('‚úÖ Solde actuel mis √† jour:', currentBalance);
                    }
                    
                    // Mettre √† jour les cartes de statistiques
                    const statCount = document.querySelector('[data-stat-count]');
                    if (statCount) {
                        statCount.textContent = transactions.length;
                    }
                    
                    const statSavings = document.querySelector('[data-stat-savings]');
                    if (statSavings) {
                        statSavings.textContent = totalSavings.toLocaleString('fr-FR', {maximumFractionDigits: 0});
                    }
                    
                    const statCurrent = document.querySelector('[data-stat-current]');
                    if (statCurrent) {
                        statCurrent.textContent = currentBalance.toLocaleString('fr-FR', {maximumFractionDigits: 0});
                    }
                    
                    const statIncome = document.querySelector('[data-stat-income]');
                    if (statIncome) {
                        statIncome.textContent = totalIncome.toLocaleString('fr-FR', {maximumFractionDigits: 0});
                    }
                    
                    console.log('‚úÖ Statistiques mises √† jour');
                });
                
                // Charger le nombre de business
                getBusinesses(user.username, function(businesses) {
                    const businessCount = document.getElementById('businessCount');
                    if (businessCount) {
                        businessCount.textContent = businesses.length;
                        console.log('‚úÖ Nombre de business mis √† jour:', businesses.length);
                    }
                });
            });
        });
    } catch (e) {
        console.error('‚ùå Erreur lors du chargement du profil:', e);
    }
}

// G√©rer les onglets en fonction de l'URL
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîÑ Initialisation de la page profil...');
    
    const params = new URLSearchParams(window.location.search);
    const tab = params.get('tab') || 'business';
    
    // Masquer tous les onglets
    document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('show', 'active');
    });
    
    // D√©sactiver tous les boutons
    document.querySelectorAll('.nav-link').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Afficher l'onglet demand√©
    if (tab === 'profil') {
        document.getElementById('content-profil').classList.add('show', 'active');
        document.getElementById('tab-profil').classList.add('active');
    } else {
        document.getElementById('content-business').classList.add('show', 'active');
        document.getElementById('tab-business').classList.add('active');
    }
    
    // Charger les informations du profil IMM√âDIATEMENT
    console.log('üìù Appel de loadProfileInfo...');
    loadProfileInfo();
    
    // G√©rer le bouton d'√©dition du profil
    const editProfileBtn = document.getElementById('editProfileBtn');
    if (editProfileBtn) {
        editProfileBtn.addEventListener('click', function() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                const user = JSON.parse(loggedInUser);
                document.getElementById('editPrenom').value = user.prenom || '';
                document.getElementById('editNom').value = user.nom || '';
                document.getElementById('editUsername').value = user.username || '';
                
                const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
                modal.show();
            }
        });
    }
    
    // G√©rer la sauvegarde du profil
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    if (saveProfileBtn) {
        saveProfileBtn.addEventListener('click', function() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                const user = JSON.parse(loggedInUser);
                user.prenom = document.getElementById('editPrenom').value;
                user.nom = document.getElementById('editNom').value;
                
                localStorage.setItem('loggedInUser', JSON.stringify(user));
                
                // Mettre √† jour l'affichage
                loadProfileInfo();
                
                // Fermer le modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
                if (modal) {
                    modal.hide();
                }
                
                alert('Profil mis √† jour avec succ√®s !');
            }
        });
    }
    
    console.log('‚úÖ Initialisation termin√©e');
});
</script>
<script src="businessetprofil.js"></script>
</body>
</html>






 